@if (ShouldShowAdminTable())
{
    <div class="content-area">
        <div class="table-bordered">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link fade show active" id="adminstudentstats-tab" data-bs-toggle="tab" data-bs-target="#adminstudentstats" type="button" role="tab" aria-controls="adminstudentstats" aria-selected="true">Φοιτητές</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="admincompaniesstats-tab" data-bs-toggle="tab" data-bs-target="#admincompaniesstats" type="button" role="tab" aria-controls="admincompaniesstats" aria-selected="false">Εταιρείες</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="adminprofessorsstats-tab" data-bs-toggle="tab" data-bs-target="#adminprofessorsstats" type="button" role="tab" aria-controls="adminprofessorsstats" aria-selected="false">Καθηγητές</button>
                </li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="tab-content mt-3" id="myTabContent">
            <!-- STUDENT STATS TAB -->
            <div class="tab-pane fade show active" id="adminstudentstats" role="tabpanel" aria-labelledby="adminstudentstats-tab">
                <div class="mb-3 row-dark-gray">
                    <div class="d-flex justify-content-between align-items-center">
                        <label class="form-label" style="color: #FFF8DC;">• Πληροφορίες Εισόδου / Εξόδου στο AcademyHub • </label>
                        <button class="btn btn-link" @onclick="ToggleFormVisibilityToShowStudentStatsAsAdmin">
                            @if (isStudentStatsFormVisibleToShowStudentStatsAsAdmin)
                            {
                                <span>&#8722;</span> <!-- Minus sign -->
                            }
                            else
                            {
                                <span>&#43;</span> <!-- Plus sign -->
                            }
                        </button>
                    </div>
                </div>

                @if(isStudentStatsFormVisibleToShowStudentStatsAsAdmin)
                {
                    <style>
                        .admintable {
                            border-color: black !important;
                        }
                        .admintable th,
                        .admintable td {
                            border-color: black !important;
                        }
                        .admintable thead th {
                            border-bottom-width: 2px !important;
                        }
                    </style>

                    <div class="table-responsive">
                        <table class="admintable table table-striped table-hover table-bordered">
                            <thead style="background-color: darkblue; color: white;">
                                <tr>
                                    <th class="align-middle">Όνομα</th>
                                    <th class="align-middle">Επώνυμο</th>
                                    <th class="align-middle">Email</th>
                                    <th class="align-middle">Τμήμα</th>
                                    <th class="align-middle">Ημ/νία Εγγραφής</th>
                                    <th class="align-middle">Τελευταία Σύνδεση</th>
                                    <th class="align-middle">Σύνδεση Από</th>
                                    <th class="align-middle">Συσκευή</th>
                                    <th class="align-middle">Τοποθεσία</th>
                                    <th class="align-middle">Αριθμός LogIn</th>
                                    <th class="align-middle">Τελευταία IP</th>
                                    <th class="align-middle">Επικυρωμένος</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var student in StudentsWithAuth0Details)
                                {
                                    <tr>
                                        <td class="align-middle">@student.Name</td>
                                        <td class="align-middle">@student.Surname</td>
                                        <td class="align-middle">@student.Email</td>
                                        <td class="align-middle">@student.Department</td>
                                        <td class="align-middle">@student.SignUpDate?.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td class="align-middle">@student.LatestLogin?.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td class="align-middle">@student.LoginBrowser</td>
                                        <td class="align-middle">@(student.IsMobile ? "Κινητό" : "Υπολογιστής")</td>
                                        <td class="align-middle">
                                            @if (student.LocationInfo != null)
                                            {
                                                <div>
                                                    <strong>@student.LocationInfo.CityName, @student.LocationInfo.CountryName</strong>
                                                    <div class="text-muted small">
                                                        <div>Country Code: @student.LocationInfo.CountryCode (@student.LocationInfo.CountryCode3)</div>
                                                        <div>Coordinates: @student.LocationInfo.Latitude.ToString("0.0000"), @student.LocationInfo.Longitude.ToString("0.0000")</div>
                                                        <div>Timezone: @student.LocationInfo.TimeZone</div>
                                                        <div>Continent: @student.LocationInfo.ContinentCode</div>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                <span>Άγνωστη τοποθεσία</span>
                                            }
                                        </td>
                                        <td class="align-middle">@student.LoginTimes</td>
                                        <td class="align-middle">@student.LastIp</td>
                                        <td class="align-middle">@(student.IsEmailVerified == true ? "Ναι" : "Όχι")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }

                <!-- ✅ Analytics Section moved inside STUDENT TAB -->
                <div class="mb-3 row-dark-gray">
                    <div class="d-flex justify-content-between align-items-center">
                        <label class="form-label" style="color: #FFF8DC;">• Στατιστικά Εγγεγραμμένων Μελών •</label>
                        <button class="btn btn-link" @onclick="ToggleAnalyticsVisibility">
                            @if (isAnalyticsVisible)
                            {
                                <span>&#8722;</span> <!-- Minus -->
                            }
                            else
                            {
                                <span>&#43;</span> <!-- Plus -->
                            }
                        </button>
                    </div>
                </div>

                @if (isAnalyticsVisible)
                {
                    <div class="d-flex justify-content-between align-items-start" style="gap: 40px;">
                        <!-- Areas Chart -->
                        <div style="flex: 1; min-height: 450px; border: 1px solid #0E202E; border-radius: 8px; padding: 15px; background-color: #f8f9fa;">
                            <h5 class="text-center" style="color: #0E202E; font-weight: bold;">Κατανομή Περιοχών Εξειδίκευσης</h5>
                            <div class="d-flex justify-content-between mb-3" style="gap:10px;">
                                <select class="form-select" @onchange="FilterAreasBySchool" style="flex: 1;">
                                    <option value="">Όλες οι Σχολές</option>
                                    @foreach (var school in AvailableSchools)
                                    {
                                        <option value="@school">@school</option>
                                    }
                                </select>
                                <select class="form-select" @onchange="FilterAreasByDepartment" style="flex: 1;">
                                    <option value="">Όλα τα Τμήματα</option>
                                    @foreach (var dept in AvailableDepartments)
                                    {
                                        <option value="@dept">@dept</option>
                                    }
                                </select>
                            </div>
                            <canvas id="areasChart" style="width: 100%; height: 100%;"></canvas>
                        </div>

                        <!-- Skills Chart -->
                        <div style="flex: 1; min-height: 450px; border: 1px solid #0E202E; border-radius: 8px; padding: 15px; background-color: #f8f9fa;">
                            <h5 class="text-center" style="color: #0E202E; font-weight: bold;">Κατανομή Τεχνικών Ικανοτήτων</h5>
                            <div class="d-flex justify-content-between mb-3" style="gap:10px;">
                                <select class="form-select" @onchange="FilterSkillsBySchool" style="flex: 1;">
                                    <option value="">Όλες οι Σχολές</option>
                                    @foreach (var school in AvailableSchools)
                                    {
                                        <option value="@school">@school</option>
                                    }
                                </select>
                                <select class="form-select" @onchange="FilterSkillsByDepartment" style="flex: 1;">
                                    <option value="">Όλα τα Τμήματα</option>
                                    @foreach (var dept in AvailableDepartments)
                                    {
                                        <option value="@dept">@dept</option>
                                    }
                                </select>
                            </div>
                            <canvas id="skillsChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>
                }
            </div> 
        </div> 
    </div> 
    <br/>
    <br/>
}

<div id="admin-table-end"></div>
