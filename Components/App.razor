@inject AuthenticationStateProvider AuthenticationStateProvider
@using System.Security.Claims
@using System.Text.Json
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@using QuizManager.Data; 
@using Microsoft.EntityFrameworkCore;
@using QuizManager.Models
@using System.Net.Mail
@inject FileUploadService FileUploadService
@inject IDbContextFactory<AppDbContext> DbContextFactory
@inject Microsoft.AspNetCore.Components.Authorization.AuthenticationStateProvider AuthenticationStateProvider
@using Microsoft.AspNetCore.Components.Forms
@using System.Net.Http.Json
@using System.Net.Http
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager
@inject InternshipEmailService InternshipEmailService
@using System.Collections.Generic
@using System.Linq
@using System.Threading.Tasks
@inject IJSRuntime JS
@using System.Globalization;
@using System.Text;


<style>
.dark-red-text {
    color: darkred;
}


    .black-text {
        color: black;
    }
    .good-message {
        background-color: green;
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
    }


    .text-underlined {
        text-decoration: underline;
    }

    .center-sev {
        position: fixed;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        display: block;
        width: 400px; /* or specific px value */
        height: 150px; /* maintains aspect ratio */
    }

    .center-uoa {
        position: fixed;
        bottom: 250px;
        left: 50%;
        transform: translateX(-50%);
        display: block;
    }

    .news-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 15px; /* Adjusted padding for a cleaner look */
        border: 1px solid #e0e0e0; /* Lighter border */
        border-radius: 10px; /* Smoother border radius */
        background-color: #ffffff; /* White background */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
        transition: transform 0.3s ease; /* Smooth transform on hover */
    }

        .news-container:hover {
            transform: translateY(-5px); /* Lift effect on hover */
        }

    .news-article {
        background-color: #fdfdfd; /* Slightly off-white background */
        padding: 15px; /* More padding for better spacing */
        border: 1px solid #e0e0e0; /* Lighter border */
        border-radius: 8px; /* Smoother border radius */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        font-size: 14px; /* Smaller font size */
        transition: transform 0.3s ease; /* Smooth transform on hover */
    }

        .news-article:hover {
            transform: translateY(-3px); /* Lift effect on hover */
        }

        .news-article h3 {
            margin: 0 0 10px; /* Space between title and content */
            font-size: 16px; /* Slightly larger font size */
        }

        .news-article p {
            margin: 0;
            color: #555; /* Softer text color */
        }

        .news-article a {
            text-decoration: none; /* Remove underline from links */
            color: #007bff; /* Modern link color */
            transition: color 0.3s ease; /* Smooth color transition */
        }

            .news-article a:hover {
                color: #0056b3; /* Darker color on hover */
            }

    .news-heading {
        font-size: 20px; /* Larger font size */
        font-weight: bold; /* Bold text */
        color: orange; /* Orange color */
    }

    .right-side-content {
        position: fixed;
        right: 20px; /* Adjust this value to move it more/less to the right */
        top: 40px; /* Adjust this value to move it more/less to the top */
        width: 200px; /* Adjust the width as needed */
    }

    .useful-links {
        position: fixed;
        bottom: 0;
        left: 0;
        padding: 10px;
        background-color: #f0f0f0; /* Background color */
        border-top: 1px solid #ddd; /* Border on top */
        width: 100%; /* Full width */
    }

        .useful-links ul {
            list-style-type: none; /* Remove bullet points */
            padding: 0;
            margin: 0;
        }

            .useful-links ul li {
                display: inline; /* Display links inline */
                margin-right: 20px; /* Add spacing between links */
            }

        .useful-links a {
            text-decoration: none; /* Remove underline from links */
            color: #333; /* Link color */
        }

        .weather-container {
        position: fixed;
        bottom: 20px; /* Adjust top position as needed */
        right: 10px; /* Adjust right position as needed */
        padding: 10px;
        z-index: 10; /* Ensure the weather container stays in front of the image */
        color: white;
        font-weight: bold;
        }

    .platform-news-container {
        position: fixed;
        bottom: 580px; /* Adjust top position as needed */
        right: 20px; /* Adjust right position as needed */
        background-color: #f0f0f0;
        padding: 10px;
        max-height: 400px; /* Ensure the container has a fixed height */
        overflow-y: auto; /* Allow scrolling if content exceeds max-height */
        width: 600px; /* Fixed width for the container */
    }

    .news-article {
        margin-bottom: 3px; /* Space between announcements */
    }

    .announcement-description {
        display: none; /* Initially hide description */
        max-width: 100%;
        margin-top: 5px; /* Space above description */
        margin-left: 20px; /* Indentation */
        overflow-wrap: break-word; /* Break long words */
        word-wrap: break-word; /* Break long words */
    }

        .announcement-description.expanded {
            display: block; /* Show description when expanded */
        }

        .right-side-announcements {
            position: fixed; /* Keep it fixed on the right side */
            right: 20px; /* Adjust this value as needed */
            top: 200px; /* Position below the header, adjust as necessary */
            width: 200px; /* Adjust the width as needed */
            background-color: #ffffff; /* Same background as news containers */
            border: 1px solid #e0e0e0; /* Same border style */
            border-radius: 10px; /* Same border radius */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Same shadow effect */
            padding: 15px; /* Padding for inner content */
            display: flex;
            flex-direction: column;
            gap: 10px; /* Space between announcements */
}

    .yellow-text {
        color: yellow; /* or any other shade you prefer */
    }

    .black-text {
        color: black; /* or any other shade you prefer */
    }

    .dark-red {
        color: darkred; /* You can also use a specific hex color code like #8B0000 */
    }

    .event-description {
        display: none; /* Hide by default */
    }

        .event-description.expanded {
            display: block; /* Show when expanded */
        }

    .calendar {
        position: fixed;
        bottom: 450px;
        right: 10px;
        background-color: #f0f0f0;
        padding: 10px;
        width: 280px; /* Adjust width for better fit */
        margin: auto;
        font-size: 0.9em;
        border: 2px solid #007BFF;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .calendar-header {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 10px;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 2px;
        padding: 0;
        text-align: center; /* Center text */
    }

    .day-header {
        font-weight: bold;
        background-color: #f0f0f0;
        padding: 5px;
        font-size: 0.8em;
        white-space: normal;
        word-wrap: break-word;
        max-width: 30px; /* Ensure headers don't overflow */
        overflow: hidden; /* Hide overflowed text */
        text-overflow: ellipsis; /* Add ellipsis if text is too long */
    }

    .empty-cell {
        background-color: transparent;
    }

    .day-cell {
        border: 1px solid #ddd;
        text-align: center;
        cursor: pointer;
        padding: 10px;
        transition: background-color 0.3s;
        font-size: 0.9em;
        min-width: 30px; /* Ensure day cells have a minimum width */
    }

        .day-cell:hover {
            background-color: #e0e0e0;
        }

    .event-indicator {
        color: darkred;
        font-weight: bold;
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 10px;
    }

    .btn-small {
        padding: 5px 10px;
        background-color: #007BFF;
        border: none;
        color: white;
        cursor: pointer;
        margin: 0 5px;
        transition: background-color 0.3s;
        border-radius: 5px;
    }

        .btn-small:hover {
            background-color: #0056b3;
        }

    .event-day {
        background-color: green;
        color: white;
        padding: 5px;
        border-radius: 8px;
        display: inline-block;
        box-sizing: content-box;
    }

    .highlighted {
        background-color: green;
        color: white;
        padding: 5px;
        border-radius: 8px;
        display: inline-block;
        box-sizing: content-box;
    }

    /* Basic modal styling */
    .modal {
        display: block;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent background */
    }

    .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 5px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }


    .today {
        background-color: #007BFF; /* Blue background */
        color: white;
        padding: 5px;
        border-radius: 8px;
        display: inline-block;
        box-sizing: content-box;
    }

    .backgroundimage-page {
        position: fixed;
        display: block;
        margin-left: -32px; /* Extends the image leftwards */
        margin-right: -500px; /* Extends the image rightwards */
        height: 100vh; /* Full viewport height */
        width: 100vw; /* Full viewport width */
        object-fit: cover; /* Ensures the image covers the container without distortion */
        bottom: 5px;
    }

</style>


<CascadingAuthenticationState>
    <Router AppAssembly="@typeof(App).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                <Authorizing>
                    <p>Determining session state, please wait...</p>
                </Authorizing>
                <NotAuthorized>
                    
                    @if (isAuthenticated)
                    {
                        @if (isEmailVerified)
                        {
                            <h1>Σημαντική Ειδοποίηση!!!</h1>
                            <p>Δεν είστε εξουσιοδοτημένοι για να συνεχίσετε! Δείτε στα εισερχόμενα μηνύματά σας, ώστε να επαληθεύσετε το email σας!</p>
                            <p>Στην συνέχεια προχωρήστε σε Σύνδεση μέσω της Κεντρικής σελίδας</p>
                        }

                    }
                    else
                    {
                        if (Navigation.Uri.EndsWith("/")) 
                        {
                            var returnUrl = Uri.EscapeDataString(Navigation.Uri);
                            Navigation.NavigateTo($"login?redirectUri={returnUrl}", forceLoad: true);
                        }

                        <div class="footer-container">
                            <div class="useful-links">
                                <ul>
                                    <li><a href="https://www.uoa.gr/">University Of Athens</a></li>
                                    <li><a href="https://eclass.uoa.gr/">eClass</a></li>
                                    <li><a href="https://fogus.gr/">Support</a></li>
                                </ul>
                            </div>
                            <div class="weather-container">
                                @if (weatherData != null)
                                {
                                    <p>Καιρός στην Αθήνα: <strong>@weatherData.temp_c °C</strong></p>
                                }
                                else
                                {
                                    <p>Παρακαλώ Περιμένετε......</p>
                                }
                            </div>
                        </div>
                        <img src="/Images/Latest_Background_2May25.png" class="backgroundimage-page" />
                    }

                    @if (isModalVisibleToShowEventsOnCalendarForEachClickedDay)
                    {
                        <div class="modal">
                            <div class="modal-content">
                                <h3>Εκδηλώσεις στις: @selectedDate?.ToString("MMMM dd, yyyy")</h3>

                                @if (selectedDateEvents.Any())
                                {
                                    <ul>
                                        @foreach (var eventItem in selectedDateEvents)
                                        {
                                            <li>@eventItem.CompanyEventTitle</li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <p>Καμία Εκδήλωση για αυτήν τη μέρα!</p>
                                }

                                <button @onclick="CloseModalShowingTheEventsOnCalendar">Κλείσιμο</button>
                            </div>
                        </div>
                    }




                </NotAuthorized>
            </AuthorizeRouteView>
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>

        <NotFound>
            <PageTitle>Not found</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <div class="footer-container">
                    <div class="useful-links">
                        <ul>
                            <li><a href="https://www.uoa.gr/">University Of Athens</a></li>
                            <li><a href="https://eclass.uoa.gr/">eClass</a></li>
                            <li><a href="https://fogus.gr/">Support</a></li>
                        </ul>
                    </div>
                    <div class="foot-container">
                        @if (weatherData != null)
                        {
                            <p>Temperature In Athens: @weatherData.temp_c °C</p>
                        }
                        else
                        {
                            <p>Weather information not available</p>
                        }
                    </div>
                </div>
            </LayoutView>
        </NotFound>
    </Router>
</CascadingAuthenticationState>



@inject NavigationManager Navigation
@inject HttpClient HttpClient
@code {
    private bool isAuthenticated;
    private bool isEmailVerified;
    private List<NewsArticle> newsArticles;
    private List<NewsArticle> svseNewsArticles;
    private string fetchError;
    private WeatherData weatherData;
    private string errorMessage;
    private List<AnnouncementAsCompany> announcements = new List<AnnouncementAsCompany>(); // Declare it as a list
    private List<AnnouncementAsProfessor> professorannouncements = new List<AnnouncementAsProfessor>(); // Declare it as a list
    public List<AnnouncementAsCompany> Announcements { get; set; }
    public List<AnnouncementAsProfessor> ProfessorAnnouncements { get; set; }
    public List<CompanyEvent> CompanyEventsToShowAtFrontPage { get; set; }

    private bool showAnnouncements = false;
    private string announcementsHeading = "<span class='black-text'>Ανακοινώσεις</span> <span class='dark-red-text'>Πλατφόρμας</span>";
    private int expandedAnnouncementId = -1;
    private int expandedProfessorAnnouncementId = -1;
    private int expandedCompanyEventId = -1;

    private int currentPage = 1; 
    private int pageSize = 3;    
    private int totalPages => (int)Math.Ceiling((double)Announcements.Where(a => a.CompanyAnnouncementStatus == "Δημοσιευμένη").Count() / pageSize);

    private int currentPageForProfessorAnnouncements = 1;
    private int totalPagesForProfessorAnnouncements => (int)Math.Ceiling((double)ProfessorAnnouncements.Where(a => a.ProfessorAnnouncementStatus == "Δημοσιευμένη").Count() / pageSize);

    private int currentCompanyEventPage = 1;
    private int currentCompanyEventpageSize = 3;
    private int totalPagesForCompanyEvents => (int)Math.Ceiling((double)CompanyEventsToShowAtFrontPage.Where(a => a.CompanyEventStatus == "Δημοσιευμένη").Count() / currentCompanyEventpageSize);

    private DateTime currentMonth = DateTime.Today;
    private string[] daysOfWeek = { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" };
    private int firstDayOfMonth => (int)new DateTime(currentMonth.Year, currentMonth.Month, 1).DayOfWeek;
    private List<CompanyEvent> selectedDateEvents = new List<CompanyEvent>();
    private bool isModalVisibleToShowEventsOnCalendarForEachClickedDay = false;
    private int daysInCurrentMonth => DateTime.DaysInMonth(currentMonth.Year, currentMonth.Month);
    private int totalCellsInGrid;
    private int remainingCells => totalCellsInGrid - (firstDayOfMonth + daysInCurrentMonth);
    private int remainingCellsValue; 
    private DateTime? selectedDate;
    private Dictionary<int, List<CompanyEvent>> eventsForDate = new Dictionary<int, List<CompanyEvent>>();
    private int selectedDay = 0; // To store the selected day
    private int highlightedDay = 0; // To store the day that needs to be highlighted
    private int adjustedFirstDayOfMonth => (firstDayOfMonth == 0) ? 6 : firstDayOfMonth - 1; // Adjust Sunday (0) to Saturday (6) and Monday (1) to 0



    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        isAuthenticated = authState.User.Identity.IsAuthenticated;

        if (isAuthenticated)
        {
            var user = authState.User;
            isEmailVerified = IsEmailVerified(user);
        }

        // Fetch necessary data
        newsArticles = await FetchNewsArticlesAsync();
        svseNewsArticles = await FetchSVSENewsArticlesAsync();
        Announcements = await FetchAnnouncementsAsync();
        ProfessorAnnouncements = await FetchProfessorAnnouncementsAsync();
        CompanyEventsToShowAtFrontPage = await FetchCompanyEventsAsync();

        LoadEventsForCalendar();
        CalculateRemainingCells();

        try
        {
            var apiUrl = "http://api.weatherapi.com/v1/forecast.json?key=551267e1b73849c5bf0104738240406&q=Athens&days=1&aqi=no&alerts=no";
            var response = await HttpClient.GetAsync(apiUrl);
            response.EnsureSuccessStatusCode();
            var jsonString = await response.Content.ReadAsStringAsync();

            var weatherResponse = JsonSerializer.Deserialize<WeatherResponse>(jsonString);
            if (weatherResponse == null || weatherResponse.current == null)
            {
                errorMessage = "Weather data not found in API response.";
                return;
            }

            weatherData = weatherResponse.current;
        }
        catch (Exception ex)
        {
            errorMessage = "Error fetching weather data: " + ex.Message;
            Console.WriteLine(errorMessage);
        }
    }


    private async Task<List<AnnouncementAsCompany>> FetchAnnouncementsAsync()
    {
        using var dbContext = await DbContextFactory.CreateDbContextAsync();
        var announcements = await dbContext.AnnouncementsAsCompany.AsNoTracking().ToListAsync(); 
        return announcements;
    }

    private async Task<List<CompanyEvent>> FetchCompanyEventsAsync()
    {
        using var dbContext = await DbContextFactory.CreateDbContextAsync();

        var companyevents = await dbContext.CompanyEvents.AsNoTracking().ToListAsync(); 
        return companyevents;
    }

    private async Task<List<AnnouncementAsProfessor>> FetchProfessorAnnouncementsAsync()
    {
        
        using var dbContext = await DbContextFactory.CreateDbContextAsync();
        var professorannouncements = await dbContext.AnnouncementsAsProfessor.AsNoTracking().ToListAsync(); 
        return professorannouncements;
    }


    private async Task<List<NewsArticle>> FetchNewsArticlesAsync()
    {
        try
        {
            var response = await HttpClient.GetAsync("https://www.uoa.gr/el/anakoinoseis_kai_ekdiloseis/anakoinoseis/");
            response.EnsureSuccessStatusCode();
            var content = await response.Content.ReadAsStringAsync();

            var htmlDocument = new HtmlAgilityPack.HtmlDocument();
            htmlDocument.LoadHtml(content);

            var articles = new List<NewsArticle>();

            var articleNodes = htmlDocument.DocumentNode.SelectNodes("//div[contains(@class, 'topnews')]");
            if (articleNodes != null)
            {
                // Limit the number of articles to 3
                for (int i = 0; i < Math.Min(articleNodes.Count, 3); i++)
                {
                    var articleNode = articleNodes[i];

                    var titleNode = articleNode.SelectSingleNode(".//h3[@class='article__title']/a");
                    var title = titleNode?.InnerText.Trim();
                    var relativeUrl = titleNode?.Attributes["href"]?.Value;
                    var url = new Uri(new Uri("https://www.uoa.gr"), relativeUrl).ToString(); // Convert relative URL to absolute URL

                    var dateNode = articleNode.SelectSingleNode(".//span[@class='article__date']/time");
                    var date = dateNode?.Attributes["datetime"]?.Value;

                    var categoryNode = articleNode.SelectSingleNode(".//span[@class='article__category']/a");
                    var category = categoryNode?.InnerText.Trim();

                    articles.Add(new NewsArticle
                        {
                            Title = title,
                            Url = url,
                            Date = date,
                            Category = category
                        });
                }
            }

            return articles;
        }
        catch (Exception ex)
        {
            fetchError = ex.Message;
            return null;
        }
        StateHasChanged();
    }

    private async Task<List<NewsArticle>> FetchSVSENewsArticlesAsync()
    {
        try
        {
            var response = await HttpClient.GetAsync("https://svse.gr/index.php/nea-anakoinoseis");
            response.EnsureSuccessStatusCode();
            var content = await response.Content.ReadAsStringAsync();

            var htmlDocument = new HtmlAgilityPack.HtmlDocument();
            htmlDocument.LoadHtml(content);

            var articles = new List<NewsArticle>();

            // Update the XPath expression to select all article nodes
            var articleNodes = htmlDocument.DocumentNode.SelectNodes("/html/body/div[1]/div/section[2]/div/div/div/main/div/div[3]/div[1]/div/div");

            if (articleNodes != null)
            {
                foreach (var articleNode in articleNodes.Take(3)) // Take only the first 3 articles
                {
                    var titleNode = articleNode.SelectSingleNode(".//h2/a");
                    var title = titleNode?.InnerText.Trim();
                    var relativeUrl = titleNode?.Attributes["href"]?.Value;
                    var url = new Uri(new Uri("https://svse.gr"), relativeUrl).ToString(); // Convert relative URL to absolute URL

                    var dateNode = articleNode.SelectSingleNode(".//time");
                    var date = dateNode?.InnerText.Trim();

                    articles.Add(new NewsArticle
                        {
                            Title = title,
                            Url = url,
                            Date = date,
                            Category = "SVSE News" 
                        });
                }
            }
            else
            {
                fetchError = "No articles found with the specified XPath.";
            }
            StateHasChanged();
            return articles;
        }
        catch (Exception ex)
        {
            fetchError = ex.Message;
            return null;
        }
        
    }


    private bool IsEmailVerified(ClaimsPrincipal user)
    {
        return user.Claims.Any(c => c.Type == "email_verified" && c.Value == "true");
    }





    protected override void OnAfterRender(bool firstRender)
    {
        if (isAuthenticated && !isEmailVerified && firstRender)
        {
            _ = HandleRedirectionAsync();
        }
    }

    private async Task HandleRedirectionAsync()
    {
        try
        {
            var userRole = await GetUserRole();

            switch (userRole)
            {
                case "Student":
                    NavigationManager.NavigateTo("/");
                    break;
                case "Company":
                    NavigationManager.NavigateTo("/");
                    break;
                case "Professor":
                    NavigationManager.NavigateTo("/");
                    break;
                default:
                    NavigationManager.NavigateTo("/"); 
                    break;
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error redirecting user: {ex.Message}");
        }
    }


    private async Task<string> GetUserRole()
    {
        var user = (await AuthenticationStateProvider.GetAuthenticationStateAsync()).User;
        if (user.IsInRole("Student"))
        {
            return "Student";
        }
        else if (user.IsInRole("Company"))
        {
            return "Company";
        }
        else if (user.IsInRole("Professor"))
        {
            return "Professor";
        }
        else
        {
            return string.Empty;
        }
    }


    public class NewsArticle
    {
        public string Title { get; set; }
        public string Url { get; set; }
        public string Date { get; set; }
        public string Category { get; set; }
    }

    public class WeatherData
    {
        public int is_day { get; set; }
        public double temp_c { get; set; }
    }

    public class ConditionInfo
    {
        public string Text { get; set; }
    }
    public class WeatherResponse
    {
        public WeatherData current { get; set; }
    }

    private void ToggleAnnouncements()
    {
        showAnnouncements = !showAnnouncements;
    }

    private void ToggleDescription(int announcementId)
    {
        if (expandedAnnouncementId == announcementId)
        {
            expandedAnnouncementId = -1;
        }
        else
        {
            expandedAnnouncementId = announcementId;
        }
    }

    private void ToggleDescriptionForProfessorAnnouncements(int announcementId)
    {
        if (expandedProfessorAnnouncementId == announcementId)
        {
            expandedProfessorAnnouncementId = -1;
        }
        else
        {
            expandedProfessorAnnouncementId = announcementId;
        }
    }

    private void ToggleDescriptionForCompanyEvent(int companyeventId)
    {
        if (expandedCompanyEventId == companyeventId)
        {
            expandedCompanyEventId = -1;
            Console.WriteLine($"Collapsed event {companyeventId}");
        }
        else
        {
            expandedCompanyEventId = companyeventId;
            Console.WriteLine($"Expanded event {companyeventId}");
        }
    }


    private async Task DownloadAnnouncementAttachmentFrontPage(byte[] attachmentData, string fileName)
    {
        if (attachmentData != null && attachmentData.Length > 0)
        {
            var base64 = Convert.ToBase64String(attachmentData);
            var fileUrl = $"data:application/pdf;base64,{base64}";

            await JSRuntime.InvokeVoidAsync("triggerDownload", fileUrl, fileName);
        }
    }

    private async Task DownloadProfessorAnnouncementAttachmentFrontPage(byte[] attachmentData, string fileName)
    {
        if (attachmentData != null && attachmentData.Length > 0)
        {
            var base64 = Convert.ToBase64String(attachmentData);
            var fileUrl = $"data:application/pdf;base64,{base64}";

            await JSRuntime.InvokeVoidAsync("triggerDownload", fileUrl, fileName);
        }
    }

    private async Task DownloadCompanyEventAttachmentFrontPage(byte[] attachmentData, string fileName)
    {
        if (attachmentData != null && attachmentData.Length > 0)
        {
            var base64 = Convert.ToBase64String(attachmentData);
            var fileUrl = $"data:application/pdf;base64,{base64}";

            await JSRuntime.InvokeVoidAsync("triggerDownload", fileUrl, fileName);
        }
    }

    private void ChangePage(int pageNumber)
    {
        if (pageNumber >= 1 && pageNumber <= totalPages)
        {
            currentPage = pageNumber;
        }
        StateHasChanged();
    }

    private void ChangePageForProfessorAnnouncements(int pageNumberForProfessorAnnouncements)
    {
        if (pageNumberForProfessorAnnouncements >= 1 && pageNumberForProfessorAnnouncements <= totalPagesForProfessorAnnouncements)
        {
            currentPageForProfessorAnnouncements = pageNumberForProfessorAnnouncements;
        }
        StateHasChanged();
    }

    private void ChangePageForCompanyEvents(int pageNumberForCompanyEvents)
    {
        if (pageNumberForCompanyEvents >= 1 && pageNumberForCompanyEvents <= totalPagesForCompanyEvents)
        {
            currentCompanyEventPage = pageNumberForCompanyEvents;
        }
        StateHasChanged();
    }

    private void LoadEventsForCalendar()
    {
        eventsForDate.Clear();
        int currentYear = currentMonth.Year;
        int currentMonthNumber = currentMonth.Month;

        // Loop through the events for the current month
        foreach (var eventItem in CompanyEventsToShowAtFrontPage)
        {
            if (eventItem.CompanyEventActiveDate.Year == currentYear &&
                eventItem.CompanyEventActiveDate.Month == currentMonthNumber)
            {
                int eventDay = eventItem.CompanyEventActiveDate.Day;
                if (!eventsForDate.ContainsKey(eventDay))
                {
                    eventsForDate[eventDay] = new List<CompanyEvent>();
                }
                eventsForDate[eventDay].Add(eventItem);
            }
        }

        // If highlighted day is not valid for this month, reset it
        if (highlightedDay != 0 && !eventsForDate.ContainsKey(highlightedDay))
        {
            highlightedDay = 0; // Reset it if there's no event for the day in the current month
        }

        // After loading events, ensure the selected and highlighted day is respected
        if (selectedDay != 0 && eventsForDate.ContainsKey(selectedDay))
        {
            highlightedDay = selectedDay; // Keep the selected day highlighted if valid
        }

        StateHasChanged();
    }



    private void ShowPreviousMonth()
    {
        currentMonth = currentMonth.AddMonths(-1);
        LoadEventsForCalendar();
        CalculateRemainingCells();  // Recalculate when changing the month
        StateHasChanged();

    }

    private void ShowNextMonth()
    {
        currentMonth = currentMonth.AddMonths(1);
        LoadEventsForCalendar();
        CalculateRemainingCells();  
        StateHasChanged();

    }

    private void OnDateClicked(DateTime clickedDate)
    {
        selectedDay = clickedDate.Day;  // Store the selected day
        highlightedDay = selectedDay;   // Set this day as highlighted

        // Handle events for this date (if any)
        if (eventsForDate.TryGetValue(selectedDay, out var events) && events.Any())
        {
            selectedDateEvents = events;
        }
        else
        {
            selectedDateEvents = new List<CompanyEvent>();
        }

        // Show the modal
        isModalVisibleToShowEventsOnCalendarForEachClickedDay = true;
        StateHasChanged();
    }



    private void CloseModalShowingTheEventsOnCalendar()
    {
        isModalVisibleToShowEventsOnCalendarForEachClickedDay = false;
        selectedDateEvents.Clear();

        // Re-render the calendar and highlight the selected day
        LoadEventsForCalendar();  // Reload events for the current month
        StateHasChanged();
    }



    private void ShowEventsForDate(List<CompanyEvent> events)
    {
        selectedDateEvents = events;
        isModalVisibleToShowEventsOnCalendarForEachClickedDay = true;
        StateHasChanged();

    }

    private void CalculateRemainingCells()
    {
        remainingCellsValue = totalCellsInGrid - (firstDayOfMonth + daysInCurrentMonth);
    }

    private void ChangeMonth(int monthChange)
    {
        currentMonth = currentMonth.AddMonths(monthChange);

        // Reset the highlighted day if it's invalid for the new month
        LoadEventsForCalendar();  // This will handle the resetting of highlightedDay
    }

}

<script>
    // ========== CHART FUNCTIONS ==========
    window.currentCharts = {};

    function generateColors(count) {
        const colors = [];
        for (let i = 0; i < count; i++) {
            const r = Math.floor(Math.random() * 255);
            const g = Math.floor(Math.random() * 255);
            const b = Math.floor(Math.random() * 255);
            colors.push(`rgba(${r}, ${g}, ${b}, 0.7)`);
        }
        return colors;
    }

    window.renderCharts = function (areaData, skillData) {
        if (areaData) {
            if (window.currentCharts?.areasChart) window.currentCharts.areasChart.destroy();
            const ctxAreas = document.getElementById("areasChart").getContext("2d");
            window.currentCharts.areasChart = new Chart(ctxAreas, {
                type: 'pie',
                data: {
                    labels: areaData.labels,
                    datasets: [{
                        data: areaData.values,
                        backgroundColor: generateColors(areaData.labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function () { return ''; },
                                label: function (context) { return context.label + ': ' + context.raw + ' Φοιτητές'; }
                            }
                        }
                    }
                }
            });
        }

        if (skillData) {
            if (window.currentCharts?.skillsChart) window.currentCharts.skillsChart.destroy();
            const ctxSkills = document.getElementById("skillsChart").getContext("2d");
            window.currentCharts.skillsChart = new Chart(ctxSkills, {
                type: 'pie',
                data: {
                    labels: skillData.labels,
                    datasets: [{
                        data: skillData.values,
                        backgroundColor: generateColors(skillData.labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function () { return ''; },
                                label: function (context) { return context.label + ': ' + context.raw + ' Φοιτητές'; }
                            }
                        }
                    }
                }
            });
        }
    };

    window.updateSkillsChart = function (skillData) {
        if (window.currentCharts?.skillsChart) window.currentCharts.skillsChart.destroy();
        if (skillData) {
            const ctxSkills = document.getElementById("skillsChart").getContext("2d");
            window.currentCharts.skillsChart = new Chart(ctxSkills, {
                type: 'pie',
                data: {
                    labels: skillData.labels,
                    datasets: [{
                        data: skillData.values,
                        backgroundColor: generateColors(skillData.labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function () { return ''; },
                                label: function (context) { return context.label + ': ' + context.raw + ' Φοιτητές'; }
                            }
                        }
                    }
                }
            });
        }
    };

    window.createDoughnutChart = (canvasId, data) => {
        var ctx = document.getElementById(canvasId).getContext('2d');
        if (!window.charts) window.charts = {};
        if (!window.charts[canvasId]) {
            window.charts[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    var label = context.label || '';
                                    if (label) label += ': ';
                                    if (context.raw !== null) label += context.raw + '%';
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    };

    window.showDoughnutChart = function (canvasId) {
        var canvas = document.getElementById(canvasId);
        if (canvas) canvas.style.display = "block";
    };

    window.hideDoughnutChart = function (canvasId) {
        var canvas = document.getElementById(canvasId);
        if (canvas) canvas.style.display = "none";
    };

    // ========== FILE DOWNLOAD FUNCTIONS ==========
    window.BlazorDownloadFile = function (fileName, fileContent) {
        const blob = new Blob([fileContent], { type: 'application/octet-stream' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    };

    window.BlazorPreviewFile = function (content) {
        const blob = new Blob([atob(content)], { type: 'application/pdf' });
        const url = window.URL.createObjectURL(blob);
        window.open(url, '_blank');
        window.URL.revokeObjectURL(url);
    };

    window.BlazorDownloadAttachmentPositionFile = (fileName, mimeType, content) => {
        const byteArray = new Uint8Array(content);
        const blob = new Blob([byteArray], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.click();
        URL.revokeObjectURL(url);
    };

    window.BlazorDownloadAttachmentThesisFile = (fileName, mimeType, base64Content) => {
        const byteCharacters = atob(base64Content);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: mimeType });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.href = url;
        link.download = fileName;
        link.click();
        URL.revokeObjectURL(url);
    };

    window.BlazorDownloadAttachmentProfessorThesisFile = (fileName, mimeType, base64Content) => {
        try {
            const byteCharacters = atob(base64Content);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: mimeType });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(url);
        } catch (error) {
            console.error('Error downloading file:', error);
        }
    };

    function downloadFile(fileName, contentType, base64Data) {
        const link = document.createElement('a');
        link.download = fileName;
        link.href = `data:${contentType};base64,${base64Data}`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function downloadStudentCVFromCompanyInternships(fileName, base64Data) {
        const link = document.createElement('a');
        link.href = 'data:application/pdf;base64,' + base64Data;
        link.download = fileName;
        link.click();
    }

    function downloadInternshipAttachmentAsStudent(fileName, base64Data) {
        const byteCharacters = atob(base64Data);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: 'application/pdf' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function saveStudentShownInterestForCompanyEventAsExcelListFile(filename, bytesBase64) {
        var link = document.createElement('a');
        link.href = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64," + bytesBase64;
        link.download = filename;
        link.click();
    }

    function saveStudentShownInterestForProfessorEventAsExcelListFile(filename, bytesBase64) {
        var link = document.createElement('a');
        link.href = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64," + bytesBase64;
        link.download = filename;
        link.click();
    }

    function saveProfessorShownInterestForCompanyEventAsExcelListFile(filename, bytesBase64) {
        var link = document.createElement('a');
        link.href = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64," + bytesBase64;
        link.download = filename;
        link.click();
    }

    function saveCompanyShownInterestForProfessorEventAsExcelListFile(filename, bytesBase64) {
        var link = document.createElement('a');
        link.href = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64," + bytesBase64;
        link.download = filename;
        link.click();
    }

    // ========== MODAL MANAGEMENT FUNCTIONS ==========
    window.showModal = (modalId) => {
        var modalElement = document.getElementById(modalId);
        var modal = new bootstrap.Modal(modalElement);
        modal.show();
    };

    window.hideModal = (modalId) => {
        var modalElement = document.getElementById(modalId);
        var modal = bootstrap.Modal.getInstance(modalElement);
        if (modal) modal.hide();
    };

    window.showUserAgreementModal = () => {
        var modal = document.getElementById("userAgreementModal");
        var mainContent = document.getElementById("mainContent");
        if (modal) {
            modal.classList.add("show");
            modal.style.display = "block";
            modal.removeAttribute("aria-hidden");
            if (mainContent) mainContent.setAttribute("inert", "");
            document.body.classList.add("modal-open");
        } else {
            console.error("Modal element with id 'userAgreementModal' not found.");
        }
    };

    window.hideUserAgreementModal = () => {
        var modal = document.getElementById("userAgreementModal");
        var mainContent = document.getElementById("mainContent");
        if (modal) {
            modal.classList.remove("show");
            modal.style.display = "none";
            modal.setAttribute("aria-hidden", "true");
            document.body.classList.remove("modal-open");
            document.body.style.overflow = "auto";
            let backdrop = document.querySelector(".modal-backdrop");
            if (backdrop) backdrop.parentNode.removeChild(backdrop);
            if (mainContent) mainContent.removeAttribute("inert");
        } else {
            console.error("Modal element with id 'userAgreementModal' not found.");
        }
    };

    function showModal(modalId) {
        var modalElement = document.getElementById(modalId);
        var modal = new bootstrap.Modal(modalElement);
        modal.show();
    }

    function showModal1(modalId) {
        var modalElement = document.querySelector(modalId);
        if (modalElement) {
            var modal = new bootstrap.Modal(modalElement);
            modal.show();
        } else {
            console.error("Modal element not found: " + modalId);
        }
    }

    function ShowBootstrapModal(modalId) {
        var modalElement = document.querySelector(modalId);
        var modal = new bootstrap.Modal(modalElement);
        modal.show();
    }

    function showCompanyDetailsModal() {
        console.log("JavaScript: Opening Modal...");
        $('#companyDetailsModal').modal('show');
    }

    function hideCompanyDetailsModal() {
        console.log("JavaScript: Hiding Modal...");
        $('#companyDetailsModal').modal('hide');
        $('body').removeClass('modal-open');
        $('.modal-backdrop').remove();
    }

    function showCompanyDetailsAsAHyperlinkInJobSearchAsStudent() {
        console.log("JavaScript: Opening Modal...");
        $('#companyDetailsModal3').modal('show');
    }

    function hideCompanyDetailsAsAHyperlinkInJobSearchAsStudent() {
        console.log("JavaScript: Hiding Modal...");
        $('#companyDetailsModal3').modal('hide');
    }

    function showCompanyDetailsModal2() {
        $('#companyDetailsModal2').modal('show');
    }

    function showInternshipDetailsModal2() {
        $('#internshipDetailsModal').modal('show');
    }

    function showJobDetailsModal() {
        $('#jobDetailsModal2').modal('show');
    }

    function showProfessorThesisDetailsModal() {
        $('#professorthesisDetailsModal').modal('show');
    }

    function hideProfessorThesisDetailsModal() {
        $('#professorthesisDetailsModal').modal('hide');
    }

    function showCompanyThesisDetailsModal() {
        $('#companythesisDetailsModal').modal('show');
    }

    function hideCompanyThesisDetailsModal() {
        $('#companythesisDetailsModal').modal('hide');
    }

    function showCompanyInternshipDetailsModal() {
        $('#companyinternshipDetailsModal').modal('show');
    }

    function hideCompanyInternshipDetailsModal() {
        $('#companyinternshipDetailsModal').modal('hide');
    }

    function showProfessorInternshipDetailsModal() {
        $('#professorinternshipDetailsModal').modal('show');
    }

    function hideProfessorInternshipDetailsModal() {
        $('#professorinternshipDetailsModal').modal('hide');
    }

    function showProfessorInternshipDetailsModalAsStudent() {
        $('#professorinternshipDetailsModalAsStudent').modal('show');
    }

    function hideProfessorInternshipDetailsModalAsStudent() {
        $('#professorinternshipDetailsModalAsStudent').modal('hide');
    }

    function showCompanyInternshipDetailsModalAsStudent() {
        $('#companyinternshipDetailsModalAsStudent').modal('show');
    }

    function hideCompanyInternshipDetailsModalAsStudent() {
        $('#companyinternshipDetailsModalAsStudent').modal('hide');
    }

    function showProfessorThesisDetailsModalAsProfessor() {
        $('#professorthesisDetailsModalAsProfessor').modal('show');
    }

    function hideProfessorThesisDetailsModalAsProfessor() {
        $('#professorthesisDetailsModalAsProfessor').modal('hide');
    }

    function showProfessorDetailsModal() {
        $('#professorDetailsModal').modal('show');
    }

    function hideProfessorDetailsModal() {
        $('#professorDetailsModal').modal('hide');
    }

    function showProfessorDetailsModalForThesisInterest() {
        $('#ProfessorDetailsModalForThesisInterest').modal('show');
    }

    function hideProfessorDetailsModalForThesisInterest() {
        $('#ProfessorDetailsModalForThesisInterest').modal('hide');
    }

    function ShowCompanyEventDetails() {
        $('#CompanyDetailsModalForThesisInterest').modal('show');
    }

    function hideCompanyDetailsModalForThesisInterest() {
        $('#CompanyDetailsModalForThesisInterest').modal('hide');
    }

    function showCompanyEventDetailsModalForEventsAsStudent() {
        $('#companyEventDetailsModal').modal('show');
    }

    function hideCompanyEventDetailsModalForEventsAsStudent() {
        $('#companyEventDetailsModal').modal('hide');
    }

    function showProfessorEventDetailsModalForEventsAsStudent() {
        $('#professorEventDetailsModal').modal('show');
    }

    function hideProfessorEventDetailsModalForEventsAsStudent() {
        $('#professorEventDetailsModal').modal('hide');
    }

    function showCompanyDetailsModalForEventsAsStudent() {
        $('#companyTitleDetailsModal').modal('show');
    }

    function hideCompanyDetailsModalForEventsAsStudent() {
        $('#companyTitleDetailsModal').modal('hide');
    }

    function showProfessorDetailsModalForEventsAsStudent() {
        $('#professorTitleDetailsModal').modal('show');
    }

    function hideProfessorDetailsModalForEventsAsStudent() {
        $('#professorTitleDetailsModal').modal('hide');
    }

    function showCompanyDetailsModalFromHyperlink() {
        $('#companyDetailsFromHyperlinkNameModal').modal('show');
    }

    function hideCompanyDetailsModalFromHyperlink() {
        $('#companyDetailsFromHyperlinkNameModal').modal('hide');
    }

    function showProfessorDetailsModalFromHypelinkName() {
        $('#professorDetailsModalFromHyperlinkName').modal('show');
    }

    function hideProfessorDetailsModalFromHypelinkName() {
        $('#professorDetailsModalFromHyperlinkName').modal('hide');
    }

    function showCompanyDetailsAsProfessorModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            var bsModal = new bootstrap.Modal(modal);
            bsModal.show();
        }
    }

    function hideCompanyDetailsAsProfessorModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            var bsModal = bootstrap.Modal.getInstance(modal);
            if (bsModal) bsModal.hide();
        }
    }

    // ========== DROPDOWN AND CHECKBOX FUNCTIONS ==========
    window.bootstrapDropdown = {
        toggleDropdown: function (elementId) {
            var dropdown = document.getElementById(elementId);
            if (dropdown) {
                var bootstrapDropdown = new bootstrap.Dropdown(dropdown);
                bootstrapDropdown.toggle();
            }
        }
    };

    function toggleCompanyInternshipCheckboxes() {
        var checkboxes = document.querySelector('.checkbox-container');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleProfessorInternshipCheckboxes() {
        var checkboxes = document.querySelector('.checkbox-container');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleCompanyJobCheckboxes() {
        var checkboxes = document.querySelector('.checkbox-container');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleCompanyThesisAreasCheckboxes() {
        var checkboxes = document.querySelector('.checkbox-containerThesisAreas');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleCompanyThesisSkillsCheckboxes() {
        var checkboxes = document.querySelector('.checkbox-containerThesisSkills');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleCompanyEventAreasCheckboxes() {
        var checkboxes = document.getElementById('toggleCheckboxesForAreasOfInterest');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleProfessorEventAreasCheckboxes() {
        var checkboxes = document.getElementById('toggleCheckboxesForAreasOfInterest');
        if (checkboxes.style.display === 'none' || checkboxes.style.display === '') {
            checkboxes.style.display = 'block';
        } else {
            checkboxes.style.display = 'none';
        }
    }

    function toggleProfessorThesisAreasCheckboxes() {
        const container = document.getElementById('toggleCheckboxesForThesisAreasAsProfessor');
        if (container.style.display === 'none') {
            container.style.display = 'block';
        } else {
            container.style.display = 'none';
        }
    }

    function toggleProfessorThesisSkillsCheckboxes() {
        const container = document.getElementById('toggleCheckboxesForThesisSkillsAsProfessor');
        if (container.style.display === 'none') {
            container.style.display = 'block';
        } else {
            container.style.display = 'none';
        }
    }

    // ========== TAB AND SECTION FUNCTIONS ==========
    function activateTab(tabId) {
        var tab = document.getElementById(tabId);
        if (tab) {
            var tabInstance = new bootstrap.Tab(tab);
            tabInstance.show();
        }
    }

    function toggleSection(contentId) {
        var content = document.getElementById(contentId);
        if (content.style.display === "none") {
            content.style.display = "block";
        } else {
            content.style.display = "none";
        }
    }

    // ========== CONFIRMATION DIALOGS ==========
    function confirmAction(message) {
        return confirm(message);
    }

    function confirmActionToAcceptOrRejectInternshipAppliedByStudentAsACompany(message) {
        return confirm(message);
    }

    function confirmActionToAcceptOrRejectJobAppliedByStudentAsACompany(message) {
        return confirm(message);
    }

    function confirmActionToAcceptOrRejectThesisAppliedByStudentAsACompany(message) {
        return confirm(message);
    }

    function confirmActionToAcceptOrRejectThesisAppliedByStudentAsAProfessor(message) {
        return confirm(message);
    }

    function confirmSaveForInternshipsAsCompany(message) {
        return confirm(message);
    }

    function confirmSaveForCompanyEvent(message) {
        return confirm(message);
    }

    function confirmSaveForProfessorEvent(message) {
        return confirm(message);
    }

    function confirmSaveForJobsAsCompany(message) {
        return confirm(message);
    }

    function confirmSaveForThesesAsCompany(message) {
        return confirm(message);
    }

    function confirmActionWithHTML(message) {
        return new Promise((resolve) => {
            Swal.fire({
                title: "Επιβεβαίωση",
                html: message,
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Ναι, συνεχίστε",
                cancelButtonText: "Ακύρωση"
            }).then((result) => {
                resolve(result.isConfirmed);
            });
        });
    }

    function confirmActionWithHTML2(message) {
        return new Promise((resolve) => {
            Swal.fire({
                title: "Ειδοποίηση",
                html: message,
                icon: "warning",
                showCancelButton: false,
                confirmButtonText: "Εντάξει!",
            }).then((result) => {
                resolve(result.isConfirmed);
            });
        });
    }

    // ========== INPUT VALIDATION FUNCTIONS ==========
    window.initializeInputMask = () => {
        const inputMaskOptions = {
            mask: '9999-9999-99999',
            placeholder: 'XXXX-YYYY-ZZZZZ',
            clearMaskOnLostFocus: false,
            oncomplete: validateRegistryNumber,
            onincomplete: validateRegistryNumber
        };
        $("#registryNumber").inputmask(inputMaskOptions);
        $("#registryNumber").on("blur", validateRegistryNumber);
    };

    function validateRegistryNumber() {
        const value = $("#registryNumber").val();
        const regex = /^\d{4}-\d{4}-\d{5}$/;

        if (regex.test(value)) {
            const parts = value.split("-");
            const xxxx = parseInt(parts[0]);
            const yyyy = parseInt(parts[1]);
            const zzzzz = parseInt(parts[2]);

            let isValid = true;

            if (![1115, 1116, 1117].includes(xxxx)) {
                isValid = false;
                $("#xxxxValidationMessage").show();
            } else {
                $("#xxxxValidationMessage").hide();
            }

            const currentYear = new Date().getFullYear();
            if (yyyy < 2010 || yyyy > currentYear) {
                isValid = false;
                $("#yyyyValidationMessage").show();
            } else {
                $("#yyyyValidationMessage").hide();
            }

            const zStr = zzzzz.toString().padStart(5, '0');
            const zPart = parseInt(zStr.slice(2));
            if (!zStr.startsWith("00") || zPart <= 0 || zPart > 300) {
                isValid = false;
                $("#zzzzzValidationMessage").show();
            } else {
                $("#zzzzzValidationMessage").hide();
            }

            if (isValid) {
                $("#registryNumber").removeClass("invalid").addClass("valid");
                $("#registryNumberValidationMessage").hide();
                return;
            }
        }

        $("#registryNumber").removeClass("valid").addClass("invalid");
        $("#registryNumberValidationMessage").show();
    }

    document.addEventListener('DOMContentLoaded', () => {
        initializeInputMask();
    });

    // ========== DROPDOWN CLICK LISTENER ==========
    function addClickListener(dotNetHelper) {
        window.dotNetHelper = dotNetHelper;
        document.addEventListener('click', handleDocumentClick);
    }

    function removeClickListener() {
        document.removeEventListener('click', handleDocumentClick);
    }

    function handleDocumentClick(event) {
        if (!event.target.closest('.dropdown-combo')) {
            window.dotNetHelper.invokeMethodAsync('OnDocumentClick');
        }
    }

    // ========== UTILITY FUNCTIONS ==========
    window.redirectToAuth0 = function (uri) {
        window.location.href = uri;
    };

    window.getSelectedValues = (selectId) => {
        const selectElement = document.getElementById(selectId);
        const selectedOptions = Array.from(selectElement.selectedOptions).map(option => option.value);
        return selectedOptions;
    };

    window.getSelectedAreas = () => {
        let selectedAreas = [];
        let checkboxes = document.querySelectorAll("input[name='area']:checked");
        checkboxes.forEach(checkbox => {
            selectedAreas.push(checkbox.value);
        });
        return selectedAreas;
    };

    function showMessage(elementId, message) {
        var messageElement = document.getElementById(elementId);
        messageElement.textContent = message;
        messageElement.style.display = 'block';
    }

    function hideMessage(elementId) {
        var messageElement = document.getElementById(elementId);
        messageElement.style.display = 'none';
    }

    window.showCustomAlert = (message) => {
        let alertBox = document.createElement('div');
        alertBox.style.position = 'fixed';
        alertBox.style.top = '60px';
        alertBox.style.right = '20px';
        alertBox.style.padding = '10px 20px';
        alertBox.style.backgroundColor = '#f8d7da';
        alertBox.style.color = '#721c24';
        alertBox.style.border = '1px solid #f5c6cb';
        alertBox.style.borderRadius = '5px';
        alertBox.style.zIndex = '1000';
        alertBox.innerText = message;
        document.body.appendChild(alertBox);
        setTimeout(() => {
            document.body.removeChild(alertBox);
        }, 3000);
    };

    // ========== SCROLL AND NAVIGATION FUNCTIONS ==========
    window.scrollToElementById = (id) => {
        const el = document.getElementById(id);
        if (el) {
            el.scrollIntoView({ behavior: "smooth", block: "center" });
            el.focus();
        }
    };

    function scrollToElement(id) {
        const element = document.getElementById(id);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            element.style.transition = 'box-shadow 0.5s';
            element.style.boxShadow = '0 0 10px gold';
            setTimeout(() => {
                element.style.boxShadow = 'none';
            }, 1000);
        }
    }

    window.scrollToSection = function (sectionId) {
        const element = document.getElementById(sectionId);
        if (element) {
            element.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    };

    // ========== GOOGLE PLACES AUTOCOMPLETE FUNCTIONS ==========
    function initializeAutocomplete() {
        const inputField = document.getElementById("autocomplete");
        if (inputField) {
            const autocomplete = new google.maps.places.Autocomplete(inputField);
            autocomplete.setFields(['address_components', 'geometry', 'name']);
            autocomplete.addListener('place_changed', function () {
                const place = autocomplete.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete initialized successfully.");
        } else {
            console.error("Autocomplete input field not found: autocomplete");
        }
    }

    function initializeAutocomplete2() {
        const inputField = document.getElementById("autocomplete2");
        if (inputField) {
            const autocomplete2 = new google.maps.places.Autocomplete(inputField);
            autocomplete2.setFields(['address_components', 'geometry', 'name']);
            autocomplete2.addListener('place_changed', function () {
                const place = autocomplete2.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete2 initialized successfully.");
        }
    }

    function initializeAutocomplete3() {
        const inputField = document.getElementById("autocomplete3");
        if (inputField) {
            const autocomplete3 = new google.maps.places.Autocomplete(inputField);
            autocomplete3.setFields(['address_components', 'geometry', 'name']);
            autocomplete3.addListener('place_changed', function () {
                const place = autocomplete3.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete3 initialized successfully.");
        }
    }

    function initializeAutocomplete4() {
        const inputField = document.getElementById("autocomplete4");
        if (inputField) {
            const autocomplete4 = new google.maps.places.Autocomplete(inputField);
            autocomplete4.setFields(['address_components', 'geometry', 'name']);
            autocomplete4.addListener('place_changed', function () {
                const place = autocomplete4.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete4 initialized successfully.");
        }
    }

    function initializeAutocomplete6() {
        const inputField = document.getElementById("autocomplete6");
        if (inputField) {
            const autocomplete6 = new google.maps.places.Autocomplete(inputField);
            autocomplete6.setFields(['address_components', 'geometry', 'name']);
            autocomplete6.addListener('place_changed', function () {
                const place = autocomplete6.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete6 initialized successfully.");
        }
    }

    function initializeAutocomplete7() {
        const inputField = document.getElementById("autocomplete7");
        if (inputField) {
            const autocomplete7 = new google.maps.places.Autocomplete(inputField);
            autocomplete7.setFields(['address_components', 'geometry', 'name']);
            autocomplete7.addListener('place_changed', function () {
                const place = autocomplete7.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete7 initialized successfully.");
        }
    }

    function initializeAutocomplete8() {
        const inputField = document.getElementById("autocomplete8");
        if (inputField) {
            const autocomplete8 = new google.maps.places.Autocomplete(inputField);
            autocomplete8.setFields(['address_components', 'geometry', 'name']);
            autocomplete8.addListener('place_changed', function () {
                const place = autocomplete8.getPlace();
                if (place) {
                    const addressComponents = place.address_components || [];
                    DotNet.invokeMethodAsync('QuizManager', 'UpdatePlaceDetails', addressComponents);
                }
            });
            console.log("Autocomplete8 initialized successfully.");
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        initializeAutocomplete();
        initializeAutocomplete2();
        initializeAutocomplete3();
        initializeAutocomplete4();
        initializeAutocomplete6();
        initializeAutocomplete7();
        initializeAutocomplete8();
    });

    // ========== TABLE FILTERING FUNCTIONS ==========
    function filterTable() {
        var dropdown = document.getElementById("positionFilter");
        var filter = dropdown.value;
        var table = document.getElementById("jobApplicationsTable");
        var rows = table.getElementsByTagName("tr");

        for (var i = 0; i < rows.length; i++) {
            var jobTypeCell = rows[i].getElementsByClassName("job-type")[0];
            if (jobTypeCell) {
                var jobType = jobTypeCell.textContent || jobTypeCell.innerText;
                if (filter === "All" || jobType === filter) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }
    }

    function moveSelectedItems(sourceId, targetId) {
        var source = document.getElementById(sourceId);
        var target = document.getElementById(targetId);
        var selectedOptions = Array.from(source.selectedOptions);
        selectedOptions.forEach(option => {
            target.appendChild(option);
        });
    }

    function clearSelection(elementId) {
        const selectElement = document.getElementById(elementId);
        if (selectElement) {
            selectElement.selectedIndex = -1;
        }
    }

    function getSelectedOptions(selectId) {
        const select = document.getElementById(selectId);
        if (!select) return [];
        return Array.from(select.selectedOptions).map(opt => opt.value);
    }

    // ========== LOCATION DROPDOWN FUNCTIONS ==========
    var selectedRegion = '';
    var selectedTown = '';

    document.addEventListener('DOMContentLoaded', function () {
        var regionDropdown = document.getElementById('internshipPerifereiaLocation');
        if (regionDropdown) {
            regionDropdown.addEventListener('change', function () {
                selectedRegion = this.value;
                var townsDropdown = document.getElementById('internshipDimosLocation');
                townsDropdown.innerHTML = '<option value="">-- Επιλέξτε Δήμο --</option>';

                if (selectedRegion && selectedRegion in window.regionToTownsMap) {
                    window.regionToTownsMap[selectedRegion].forEach(function (town) {
                        var option = document.createElement('option');
                        option.value = town;
                        option.text = town;
                        townsDropdown.appendChild(option);
                    });
                }
            });
        }
    });

    // ========== RESEARCH GROUP REDIRECT PROTECTION ==========
    (function () {
        if (window.location.pathname === '/researchGroupDetails' ||
            window.location.pathname.includes('/researchGroupDetails')) {

            console.log('Research group page detected - applying redirect protection');

            const originalPushState = history.pushState;
            history.pushState = function () {
                console.log('Blocked pushState navigation from research group page');
                return;
            };

            const originalReplaceState = history.replaceState;
            history.replaceState = function () {
                console.log('Blocked replaceState navigation from research group page');
                return;
            };

            window.addEventListener('beforeunload', function (e) {
                if (!window.location.pathname.includes('/researchGroupDetails')) {
                    console.log('Preventing navigation away from research group page');
                    e.preventDefault();
                    e.returnValue = '';
                    return '';
                }
            });

            setTimeout(function () {
                if (!window.location.pathname.includes('/researchGroupDetails')) {
                    console.log('Redirect detected, returning to research group page');
                    window.history.replaceState(null, '', window.location.href);
                }
            }, 100);
        }
    })();

    // ========== CONTAINER TOGGLE FUNCTIONS ==========
    let isHidden = false;

    function ToggleContainer() {
        const mainContainer = document.getElementById("main-container");
        const arrowIcon = document.getElementById("arrow-icon");

        if (isHidden) {
            mainContainer.classList.remove("hidden");
            arrowIcon.classList.remove("fa-arrow-left");
            arrowIcon.classList.add("fa-arrow-right");
        } else {
            mainContainer.classList.add("hidden");
            arrowIcon.classList.remove("fa-arrow-right");
            arrowIcon.classList.add("fa-arrow-left");
        }
        isHidden = !isHidden;
    }

    window.triggerDownload = (fileUrl, fileName) => {
        const link = document.createElement('a');
        link.href = fileUrl;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    // ========== PROJECT SEARCH FUNCTIONS ==========
    function searchProject() {
        const projectId = document.getElementById('projectIdInput').value.trim();
        if (!projectId) {
            alert("Please enter a Project ID");
            return;
        }

        const resultsDiv = document.getElementById('projectResults');
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = '<p>Loading project information...</p>';

        fetchProjectData(projectId)
            .then(projectInfo => {
                if (projectInfo.error) {
                    resultsDiv.innerHTML = `<p class="text-danger">${projectInfo.error}</p>`;
                    return;
                }

                document.getElementById('projectTitle').textContent = projectInfo.title;
                document.getElementById('projectAcronym').textContent = projectInfo.acronym;
                document.getElementById('projectGrantId').textContent = projectInfo.grant_id;
                document.getElementById('projectStatus').textContent = projectInfo.status;
                document.getElementById('projectDuration').textContent = `${projectInfo.start_date} to ${projectInfo.end_date}`;
                document.getElementById('projectTotalCost').textContent = projectInfo.total_cost;
                document.getElementById('projectEuContribution').textContent = projectInfo.eu_contribution;
                document.getElementById('projectCoordinator').textContent = projectInfo.coordinator;
                document.getElementById('projectDescription').textContent = projectInfo.description;
            })
            .catch(error => {
                resultsDiv.innerHTML = `<p class="text-danger">Error fetching project data: ${error.message}</p>`;
            });
    }

    function fetchProjectData(projectId) {
        return Promise.resolve({
            title: "OPTIMised video content delivery chains leveraging data analysis over joint multI-accesS edge computing and 5G radio network infrasTructures",
            acronym: "OPTIMIST",
            grant_id: "872866",
            status: "Project closed",
            start_date: "1 May 2020",
            end_date: "30 April 2025",
            total_cost: "€ 1,490,400.00",
            eu_contribution: "€ 1,490,400.00",
            coordinator: "ETHNIKO KAI KAPODISTRIAKO PANEPISTIMIO ATHINON, Greece",
            description: "The OPTIMIST programme sets the ambitious aim to develop a modular end-to-end service platform tailored to the optimized delivery of personalised video content in 5G mobile networks..."
        });
    }

    // ========== NAVIGATION LOADER FUNCTIONS ==========
    function showBlazorNavigationLoader(message = "Παρακαλώ Περιμένετε...") {
        const existingLoader = document.getElementById('blazor-navigation-loader');
        if (existingLoader) existingLoader.remove();

        const loader = document.createElement('div');
        loader.id = 'blazor-navigation-loader';
        loader.innerHTML = `
<div style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
        ">
    <div style="
                text-align: center;
                padding: 40px;
                background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
                border-radius: 15px;
                box-shadow: 0 0 40px rgba(0, 150, 255, 0.3);
                border: 1px solid #3498db;
                max-width: 400px;
                width: 90%;
            ">
        <div style="
                    border: 5px solid rgba(255, 255, 255, 0.1);
                    border-top: 5px solid #3498db;
                    border-radius: 50%;
                    width: 60px;
                    height: 60px;
                    animation: spin 1s linear infinite;
                    margin: 0 auto 25px auto;
                "></div>
        <div style="
                    font-size: 22px;
                    font-weight: bold;
                    margin-bottom: 15px;
                    color: white;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                ">
            ${message}
        </div>
        <div style="
                    font-size: 16px;
                    opacity: 0.8;
                    color: #ccc;
                    margin-bottom: 10px;
                ">
            Η σελίδα ανανεώνεται...
        </div>
        <div style="
                    font-size: 14px;
                    opacity: 0.6;
                    color: #aaa;
                ">
            Παρακαλώ μην κλείσετε το παράθυρο, γίνεται ανακατεύθυνση...
        </div>
    </div>
</div>
        `;

        document.body.appendChild(loader);

        if (!document.getElementById('blazor-loader-styles')) {
            const style = document.createElement('style');
            style.id = 'blazor-loader-styles';
            style.textContent = `
@@keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            #blazor-navigation-loader {
                animation: fadeIn 0.3s ease-in;
            }
@@keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
        `;
            document.head.appendChild(style);
        }
    }

    function hideBlazorNavigationLoader() {
        const loader = document.getElementById('blazor-navigation-loader');
        if (loader) {
            loader.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => loader.remove(), 300);
        }
    }

    // Initialize Bootstrap modals
    var companyDetailsModal = new bootstrap.Modal(document.getElementById('companyDetailsModal') || document.createElement('div'), {
        backdrop: 'static',
        keyboard: false
    });

    var studentDetailsModal = new bootstrap.Modal(document.getElementById('studentDetailsModal') || document.createElement('div'), {
        backdrop: 'static',
        keyboard: false
    });
</script>
